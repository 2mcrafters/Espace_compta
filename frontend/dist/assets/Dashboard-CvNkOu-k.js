import{j as e,R as x,m as u,d as b}from"./index-6jc1YW1i.js";import{u as j}from"./useQuery-SKqCO6Ti.js";import{I as v}from"./Input-D8FRziaI.js";import{B as M}from"./Button-DWzqGaEt.js";function $({start:s,end:i,onChange:l,className:c=""}){return e.jsxs("div",{className:`flex items-end gap-3 ${c}`,children:[e.jsx(v,{label:"Start",type:"date",value:s??"",onChange:o=>l==null?void 0:l({start:o.target.value,end:i})}),e.jsx(v,{label:"End",type:"date",value:i??"",onChange:o=>l==null?void 0:l({start:s,end:o.target.value})})]})}function C(s,i){return j({queryKey:["productivity",s,i],queryFn:async()=>{const{data:l}=await b.get("/reports/productivity",{params:{from:s,to:i}});return l},enabled:!!s&&!!i})}function L(){var g,h,y;const s=new Date,i=new Date(s.getFullYear(),s.getMonth(),1).toISOString().slice(0,10),l=new Date(s.getFullYear(),s.getMonth()+1,0).toISOString().slice(0,10),[c,o]=x.useState({start:i,end:l}),{data:a,isLoading:p}=C(c.start,c.end),{data:r}=j({queryKey:["overview"],queryFn:async()=>(await b.get("/overview")).data}),N=x.useMemo(()=>{var n;return a&&((n=a.per_client)==null?void 0:n.reduce((d,m)=>d+Number(m.minutes||0),0))||0},[a]),w=x.useMemo(()=>{const t=(a==null?void 0:a.per_client)||[];if(t.length===0)return"—";const n=t.reduce((d,m)=>Number(m.minutes)>Number(d.minutes)?m:d,t[0]);return`Client #${n.client_id} (${n.minutes}m)`},[a]),_=x.useMemo(()=>{const t=(a==null?void 0:a.per_user)||[];if(t.length===0)return"—";const n=t.reduce((d,m)=>Number(m.minutes)>Number(d.minutes)?m:d,t[0]);return`User #${n.user_id} (${n.minutes}m)`},[a]),k=[{title:"Total minutes",value:N,icon:"⏱️",color:"from-primary-400 to-primary-600",textColor:"text-primary-700"},{title:"Top client",value:w,icon:"🏆",color:"from-purple-500 to-pink-500",textColor:"text-pink-600"},{title:"Top collaborator",value:_,icon:"⭐",color:"from-orange-500 to-red-500",textColor:"text-red-600"},{title:"Clients",value:((g=r==null?void 0:r.counts)==null?void 0:g.clients)??"—",icon:"👥",color:"from-blue-500 to-sky-600",textColor:"text-sky-600"},{title:"Portefeuilles",value:((h=r==null?void 0:r.counts)==null?void 0:h.portfolios)??"—",icon:"🗂️",color:"from-indigo-500 to-purple-600",textColor:"text-indigo-600"},{title:"Documents",value:((y=r==null?void 0:r.counts)==null?void 0:y.docs)??"—",icon:"📄",color:"from-emerald-500 to-teal-600",textColor:"text-emerald-600"}];return e.jsxs("div",{className:"space-y-8",children:[e.jsxs(u.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex flex-col md:flex-row md:items-end md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent mb-2",children:"Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Vue d'ensemble de votre productivité"})]}),e.jsxs("div",{className:"flex flex-wrap items-end gap-3",children:[e.jsx($,{start:c.start,end:c.end,onChange:o}),e.jsx("a",{target:"_blank",rel:"noreferrer",href:"http://127.0.0.1:8002/api/exports/time-excel",children:e.jsxs(M,{className:"!from-emerald-500 !to-green-600 !shadow-emerald-500/30 hover:!shadow-emerald-500/50 hover:!from-emerald-600 hover:!to-green-700",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Exporter (Excel)"]})})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:k.map((t,n)=>e.jsxs(u.div,{initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:n*.1},whileHover:{y:-8,scale:1.03,boxShadow:"0 25px 50px rgba(0, 0, 0, 0.15)",transition:{type:"spring",stiffness:300}},className:"relative overflow-hidden rounded-2xl bg-white border border-gray-200 p-6 shadow-lg transition-all duration-300 cursor-pointer group",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 bg-gradient-to-br ${t.color} opacity-10 rounded-full -translate-y-1/2 translate-x-1/2 group-hover:opacity-20 transition-opacity duration-300`}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent via-white/50 to-transparent opacity-0 group-hover:opacity-100 transform -translate-x-full group-hover:translate-x-full transition-all duration-1000"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-600",children:t.title}),e.jsx(u.div,{animate:{rotate:[0,10,-10,0]},transition:{duration:2,repeat:1/0,repeatDelay:3},whileHover:{scale:1.2,rotate:360},className:"text-3xl",children:t.icon})]}),e.jsx("div",{className:`text-3xl font-bold ${t.textColor}`,children:p?e.jsx("div",{className:"h-9 bg-gray-200 rounded animate-pulse w-24"}):t.value})]})]},n))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(f,{title:"Minutes par client",data:((a==null?void 0:a.per_client)||[]).map(t=>({label:`C${t.client_id}`,value:Number(t.minutes||0)})),isLoading:p}),e.jsx(f,{title:"Minutes par collaborateur",data:((a==null?void 0:a.per_user)||[]).map(t=>({label:`U${t.user_id}`,value:Number(t.minutes||0)})),isLoading:p}),e.jsxs("div",{className:"lg:col-span-2 rounded-2xl border border-gray-200 bg-white p-6 shadow-lg",children:[e.jsx("h3",{className:"font-semibold text-lg mb-4 text-gray-900",children:"Activité récente"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-600 mb-2",children:"Nouveaux documents"}),e.jsx("ul",{className:"space-y-2",children:((r==null?void 0:r.recent_docs)||[]).map(t=>e.jsxs("li",{className:"text-sm text-gray-700",children:[t.title," ",e.jsxs("span",{className:"text-gray-400",children:["(",t.category||"—",")"]})]},t.id))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-600 mb-2",children:"Nouveaux clients"}),e.jsx("ul",{className:"space-y-2",children:((r==null?void 0:r.recent_clients)||[]).map(t=>e.jsx("li",{className:"text-sm text-gray-700",children:t.raison_sociale},t.id))})]})]})]})]})]})}function f({title:s,data:i,isLoading:l}){const c=Math.max(1,...i.map(o=>o.value));return e.jsxs(u.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-lg",children:[e.jsx("h3",{className:"font-semibold text-lg mb-6 text-gray-900",children:s}),e.jsx("div",{className:"space-y-4",children:l?Array.from({length:3}).map((o,a)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-4 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"flex-1 h-6 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"w-12 h-4 bg-gray-200 rounded animate-pulse"})]},a)):i.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-2 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),"Aucune donnée"]}):i.map((o,a)=>e.jsxs(u.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:a*.05},className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 text-xs font-medium text-gray-600",children:o.label}),e.jsx("div",{className:"flex-1 h-8 bg-gradient-to-r from-gray-100 to-gray-50 rounded-lg overflow-hidden",children:e.jsx(u.div,{initial:{width:0},animate:{width:`${o.value/c*100}%`},transition:{duration:1,delay:a*.1,ease:"easeOut"},className:"h-full bg-gradient-to-r from-primary-500 to-primary-700 rounded-lg shadow-sm"})}),e.jsxs("div",{className:"w-12 text-xs font-semibold text-gray-900 text-right",children:[o.value,"m"]})]},a))})]})}export{L as default};
