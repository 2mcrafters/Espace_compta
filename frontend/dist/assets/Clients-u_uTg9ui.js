import{e as A,b as L,f as z,R as g,j as e,m as N,C as Q,M as H,d as f}from"./index-pDHLf4_7.js";import{u as T}from"./useQuery-kMVKj7Cj.js";import{u as S}from"./useMutation-CfG6Mqyy.js";import{B as q}from"./Button-CzOS0oQW.js";import{I as x}from"./Input-GRIl-wof.js";import{R as $}from"./RequirePermission-TZbtanVt.js";function O(){return T({queryKey:["clients"],queryFn:async()=>{const{data:r}=await f.get("/clients");return(r==null?void 0:r.data)??r}})}function U(){return T({queryKey:["portfolios"],queryFn:async()=>(await f.get("/portfolios")).data})}function se(){var o;const r=A();L(z);const{data:p=[],isLoading:u}=O(),{data:y=[]}=U(),[b,m]=g.useState(!1),[j,s]=g.useState(null),[c,l]=g.useState(null),[d,a]=g.useState(null),[h,k]=g.useState(null),v=S({mutationFn:async n=>{const{rc_file:w,if_file:F,ice_file:_,forme_juridique_file:E,id:I,...P}=n||{},R=(I?await f.put(`/clients/${I}`,P):await f.post("/clients",P)).data,B=(R==null?void 0:R.id)||I,K=[],G=[{file:w,category:"RC"},{file:F,category:"IF"},{file:_,category:"ICE"},{file:E,category:"Forme juridique"}];for(const M of G)if(M.file){const D=new FormData;D.append("file",M.file),D.append("category",M.category),D.append("title",M.file.name),K.push(f.post(`/clients/${B}/documents`,D,{headers:{"Content-Type":"multipart/form-data"}}))}return K.length&&await Promise.allSettled(K),R},onSuccess:()=>{r.invalidateQueries({queryKey:["clients"]}),m(!1),s(null)}}),t=S({mutationFn:async n=>(await f.delete(`/clients/${n}`)).data,onSuccess:()=>{r.invalidateQueries({queryKey:["clients"]}),l(null)}});function i(){s(null),m(!0)}function C(n){s(n),m(!0)}return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-gray-100 dark:to-gray-400 bg-clip-text text-transparent",children:"Clients"}),e.jsx($,{perm:"clients.edit",fallback:null,children:e.jsx(q,{onClick:i,children:"Ajouter un client"})})]}),u?e.jsx("div",{className:"text-gray-500",children:"Chargement..."}):e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},children:e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700 text-gray-800 dark:text-gray-100",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900/20",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Client"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Téléphone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contrat"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-100 dark:divide-gray-700",children:(o=p==null?void 0:p.map)==null?void 0:o.call(p,n=>{var w,F;return e.jsxs(N.tr,{initial:{opacity:0},animate:{opacity:1},children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary-400 to-primary-700 flex items-center justify-center text-white font-bold mr-3 shadow-lg",children:((F=(w=n.raison_sociale)==null?void 0:w.charAt(0))==null?void 0:F.toUpperCase())||"C"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:n.raison_sociale})]})}),e.jsx("td",{className:"px-6 py-4 text-gray-600 dark:text-gray-300",children:n.email||"—"}),e.jsx("td",{className:"px-6 py-4 text-gray-600 dark:text-gray-300",children:n.telephone||"—"}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-emerald-100 text-emerald-700",children:n.montant_contrat?`${parseFloat(n.montant_contrat).toLocaleString()} €`:"—"})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(N.button,{whileHover:{scale:1.05,y:-2,boxShadow:"0 10px 25px rgba(59, 130, 246, 0.35)"},whileTap:{scale:.95},onClick:()=>a(n),className:"px-3 py-1.5 rounded-lg bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white text-sm font-medium shadow-md transition-all duration-300 relative overflow-hidden group",children:[e.jsx("span",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent opacity-0 group-hover:opacity-100 transform -translate-x-full group-hover:translate-x-full transition-all duration-500"}),e.jsx("span",{className:"relative",children:"Documents"})]}),e.jsx($,{perm:"clients.edit",fallback:null,children:e.jsxs(N.button,{whileHover:{scale:1.05,y:-2,boxShadow:"0 10px 25px rgba(59, 130, 246, 0.35)"},whileTap:{scale:.95},onClick:()=>k(n),className:"px-3 py-1.5 rounded-lg bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-700 text-white text-sm font-medium shadow-md transition-all duration-300 relative overflow-hidden group",children:[e.jsx("span",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent opacity-0 group-hover:opacity-100 transform -translate-x-full group-hover:translate-x-full transition-all duration-500"}),e.jsx("span",{className:"relative",children:"Collaborateurs"})]})}),e.jsx($,{perm:"clients.edit",fallback:null,children:e.jsxs(N.button,{whileHover:{scale:1.05,y:-2,boxShadow:"0 10px 25px rgba(75, 85, 99, 0.4)"},whileTap:{scale:.95},onClick:()=>C(n),className:"px-3 py-1.5 rounded-lg bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white text-sm font-medium shadow-md transition-all duration-300 relative overflow-hidden group",children:[e.jsx("span",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent opacity-0 group-hover:opacity-100 transform -translate-x-full group-hover:translate-x-full transition-all duration-500"}),e.jsx("span",{className:"relative",children:"Modifier"})]})}),e.jsx($,{perm:"clients.edit",fallback:null,children:e.jsxs(N.button,{whileHover:{scale:1.05,y:-2,boxShadow:"0 10px 25px rgba(239, 68, 68, 0.4)"},whileTap:{scale:.95},onClick:()=>l(n),className:"px-3 py-1.5 rounded-lg bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white text-sm font-medium shadow-md transition-all duration-300 relative overflow-hidden group",children:[e.jsx("span",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent opacity-0 group-hover:opacity-100 transform -translate-x-full group-hover:translate-x-full transition-all duration-500"}),e.jsx("span",{className:"relative",children:"Supprimer"})]})})]})})]},n.id)})})]})})}),e.jsx(W,{open:b,onClose:()=>{m(!1),s(null)},portfolios:y,client:j,onSubmit:n=>v.mutate(n),saving:v.isPending}),e.jsx(Q,{open:!!c,title:"Supprimer le client",description:`Êtes-vous sûr de vouloir supprimer ${c==null?void 0:c.raison_sociale} ?`,onCancel:()=>l(null),onConfirm:()=>t.mutate(c.id)}),e.jsx(J,{client:d,onClose:()=>a(null)}),e.jsx(V,{client:h,onClose:()=>k(null)})]})}function V({client:r,onClose:p}){const u=!!r,y=A(),{data:b=[]}=T({queryKey:["users-lookup"],queryFn:async()=>(await f.get("/users/lookup")).data,enabled:u}),{data:m=[]}=T({queryKey:["client-collabs",r==null?void 0:r.id],queryFn:async()=>(await f.get(`/clients/${r.id}/collaborators`)).data,enabled:u}),j=S({mutationFn:async d=>(await f.post(`/clients/${r.id}/collaborators`,{user_id:d})).data,onSuccess:()=>y.invalidateQueries({queryKey:["client-collabs",r==null?void 0:r.id]})}),s=S({mutationFn:async d=>(await f.delete(`/clients/${r.id}/collaborators/${d}`)).data,onSuccess:()=>y.invalidateQueries({queryKey:["client-collabs",r==null?void 0:r.id]})}),[c,l]=g.useState(null);return e.jsxs(H,{open:u,onClose:p,title:r?`Collaborateurs • ${r.raison_sociale}`:"Collaborateurs",footer:e.jsx("div",{className:"flex gap-2",children:e.jsx(q,{onClick:p,className:"!from-gray-200 !to-gray-300 !text-gray-800",children:"Fermer"})}),children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Tous les utilisateurs"}),e.jsx("ul",{className:"divide-y",children:b.map(d=>e.jsxs("li",{className:"py-2 flex items-center justify-between",children:[e.jsxs("span",{children:[d.name," ",e.jsxs("span",{className:"text-gray-500 text-xs",children:["(",d.email,")"]})]}),e.jsx(q,{onClick:()=>j.mutate(d.id),className:"!from-blue-500 !to-blue-600",children:"Ajouter"})]},d.id))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Collaborateurs du client"}),e.jsx("ul",{className:"divide-y",children:m.map(d=>e.jsxs("li",{className:"py-2 flex items-center justify-between",children:[e.jsxs("span",{children:[d.name," ",e.jsxs("span",{className:"text-gray-500 text-xs",children:["(",d.email,")"]})]}),e.jsx(q,{onClick:()=>l(d),className:"!from-red-500 !to-red-600",children:"Retirer"})]},d.id))})]})]}),e.jsx(Q,{open:!!c,title:"Retirer le collaborateur",description:c?`Retirer ${c.name} du client ${r==null?void 0:r.raison_sociale} ?`:"",onCancel:()=>l(null),onConfirm:()=>{c&&(s.mutate(c.id),l(null))}})]})}function W({open:r,onClose:p,client:u,onSubmit:y,saving:b,portfolios:m=[]}){var v;const j={portfolio_id:((v=m==null?void 0:m[0])==null?void 0:v.id)||"",raison_sociale:"",email:"",telephone:"",montant_contrat:"",adresse:"",forme_juridique:"",statut_juridique:"",date_creation:"",capital_social:"",regime_fiscal:"",date_debut_collaboration:"",responsable_client:"",type_mission:"",rc:"",if:"",ice:"",rc_file:null,if_file:null,ice_file:null,forme_juridique_file:null},[s,c]=g.useState(u||j);g.useEffect(()=>{c(u||j)},[u,m]);const[l,d]=g.useState({rc:"text",if:"text",ice:"text",forme:"text"});g.useEffect(()=>{d({rc:"text",if:"text",ice:"text",forme:"text"})},[u]);function a(t,i){c(C=>({...C,[t]:i}))}function h(t,i){d(C=>({...C,[t]:i})),i==="text"?(t==="rc"&&a("rc_file",null),t==="if"&&a("if_file",null),t==="ice"&&a("ice_file",null),t==="forme"&&a("forme_juridique_file",null)):(t==="rc"&&a("rc",""),t==="if"&&a("if",""),t==="ice"&&a("ice",""),t==="forme"&&a("forme_juridique",""))}function k(t){t.preventDefault();const i={...s};l.rc==="text"?i.rc_file=null:i.rc="",l.if==="text"?i.if_file=null:i.if="",l.ice==="text"?i.ice_file=null:i.ice="",l.forme==="text"?i.forme_juridique_file=null:i.forme_juridique="",y==null||y(i)}return e.jsx(H,{open:r,onClose:p,title:u!=null&&u.id?"Modifier le client":"Ajouter un client",className:"max-w-4xl",footer:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(N.button,{whileHover:{scale:1.03,borderColor:"rgb(156, 163, 175)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.97},className:"px-5 py-2.5 rounded-lg border-2 border-gray-300 font-semibold text-gray-700 hover:bg-gray-50 transition-all duration-300",onClick:p,children:"Annuler"}),e.jsx($,{perm:"clients.edit",fallback:null,children:e.jsx(q,{disabled:b,onClick:k,children:b?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Enregistrement..."]}):"Enregistrer"})})]}),children:e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-700 bg-white/60 dark:bg-gray-900/40 backdrop-blur p-4 md:p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"w-1.5 h-6 bg-gradient-to-b from-primary-400 to-primary-600 rounded"}),e.jsx("h4",{className:"text-sm font-semibold text-gray-800 dark:text-gray-100",children:"Liaison"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Portefeuille"}),e.jsxs("select",{className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100",value:s.portfolio_id,onChange:t=>a("portfolio_id",t.target.value),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Sélectionner..."}),m==null?void 0:m.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsx(x,{label:"Raison sociale",value:s.raison_sociale,onChange:t=>a("raison_sociale",t.target.value),required:!0})]})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-700 bg-white/60 dark:bg-gray-900/40 backdrop-blur p-4 md:p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"w-1.5 h-6 bg-gradient-to-b from-primary-400 to-primary-600 rounded"}),e.jsx("h4",{className:"text-sm font-semibold text-gray-800 dark:text-gray-100",children:"Coordonnées"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(x,{label:"Adresse",value:s.adresse,onChange:t=>a("adresse",t.target.value)}),e.jsx(x,{label:"Email",type:"email",value:s.email,onChange:t=>a("email",t.target.value)}),e.jsx(x,{label:"Téléphone",value:s.telephone,onChange:t=>a("telephone",t.target.value)}),e.jsx(x,{label:"Responsable client",value:s.responsable_client,onChange:t=>a("responsable_client",t.target.value)})]})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-700 bg-white/60 dark:bg-gray-900/40 backdrop-blur p-4 md:p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"w-1.5 h-6 bg-gradient-to-b from-primary-400 to-primary-600 rounded"}),e.jsx("h4",{className:"text-sm font-semibold text-gray-800 dark:text-gray-100",children:"Informations légales"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"RC"}),e.jsxs("div",{className:"inline-flex rounded-md border border-gray-300 dark:border-gray-700 overflow-hidden",children:[e.jsx("button",{type:"button",onClick:()=>h("rc","text"),className:`px-2.5 py-1 text-xs ${l.rc==="text"?"bg-primary-600 text-white":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200"}`,children:"Texte"}),e.jsx("button",{type:"button",onClick:()=>h("rc","file"),className:`px-2.5 py-1 text-xs ${l.rc==="file"?"bg-primary-600 text-white":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200"}`,children:"Fichier"})]})]}),l.rc==="text"?e.jsx(x,{label:"RC (texte)",value:s.rc||"",onChange:t=>a("rc",t.target.value)}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"RC (fichier)"}),e.jsxs("label",{className:"flex items-center justify-center border-2 border-dashed rounded-lg py-7 px-3 text-sm text-gray-500 dark:text-gray-400 border-gray-300 dark:border-gray-700 hover:border-primary-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors cursor-pointer",children:[e.jsx("input",{className:"hidden",type:"file",onChange:t=>{var i;return a("rc_file",((i=t.target.files)==null?void 0:i[0])||null)}}),s.rc_file?e.jsxs("div",{className:"w-full flex items-center justify-between gap-2",children:[e.jsx("span",{className:"truncate",children:s.rc_file.name}),e.jsx("button",{type:"button",className:"text-red-600 dark:text-red-400 text-xs",onClick:()=>a("rc_file",null),children:"Retirer"})]}):e.jsx("span",{children:"Glisser-déposer ou cliquer pour choisir"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"IF"}),e.jsxs("div",{className:"inline-flex rounded-md border border-gray-300 dark:border-gray-700 overflow-hidden",children:[e.jsx("button",{type:"button",onClick:()=>h("if","text"),className:`px-2.5 py-1 text-xs ${l.if==="text"?"bg-primary-600 text-white":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200"}`,children:"Texte"}),e.jsx("button",{type:"button",onClick:()=>h("if","file"),className:`px-2.5 py-1 text-xs ${l.if==="file"?"bg-primary-600 text-white":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200"}`,children:"Fichier"})]})]}),l.if==="text"?e.jsx(x,{label:"IF (texte)",value:s.if||"",onChange:t=>a("if",t.target.value)}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"IF (fichier)"}),e.jsxs("label",{className:"flex items-center justify-center border-2 border-dashed rounded-lg py-7 px-3 text-sm text-gray-500 dark:text-gray-400 border-gray-300 dark:border-gray-700 hover:border-primary-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors cursor-pointer",children:[e.jsx("input",{className:"hidden",type:"file",onChange:t=>{var i;return a("if_file",((i=t.target.files)==null?void 0:i[0])||null)}}),s.if_file?e.jsxs("div",{className:"w-full flex items-center justify-between gap-2",children:[e.jsx("span",{className:"truncate",children:s.if_file.name}),e.jsx("button",{type:"button",className:"text-red-600 dark:text-red-400 text-xs",onClick:()=>a("if_file",null),children:"Retirer"})]}):e.jsx("span",{children:"Glisser-déposer ou cliquer pour choisir"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"ICE"}),e.jsxs("div",{className:"inline-flex rounded-md border border-gray-300 dark:border-gray-700 overflow-hidden",children:[e.jsx("button",{type:"button",onClick:()=>h("ice","text"),className:`px-2.5 py-1 text-xs ${l.ice==="text"?"bg-primary-600 text-white":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200"}`,children:"Texte"}),e.jsx("button",{type:"button",onClick:()=>h("ice","file"),className:`px-2.5 py-1 text-xs ${l.ice==="file"?"bg-primary-600 text-white":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200"}`,children:"Fichier"})]})]}),l.ice==="text"?e.jsx(x,{label:"ICE (texte)",value:s.ice||"",onChange:t=>a("ice",t.target.value)}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ICE (fichier)"}),e.jsxs("label",{className:"flex items-center justify-center border-2 border-dashed rounded-lg py-7 px-3 text-sm text-gray-500 dark:text-gray-400 border-gray-300 dark:border-gray-700 hover:border-primary-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors cursor-pointer",children:[e.jsx("input",{className:"hidden",type:"file",onChange:t=>{var i;return a("ice_file",((i=t.target.files)==null?void 0:i[0])||null)}}),s.ice_file?e.jsxs("div",{className:"w-full flex items-center justify-between gap-2",children:[e.jsx("span",{className:"truncate",children:s.ice_file.name}),e.jsx("button",{type:"button",className:"text-red-600 dark:text-red-400 text-xs",onClick:()=>a("ice_file",null),children:"Retirer"})]}):e.jsx("span",{children:"Glisser-déposer ou cliquer pour choisir"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Forme juridique"}),e.jsxs("div",{className:"inline-flex rounded-md border border-gray-300 dark:border-gray-700 overflow-hidden",children:[e.jsx("button",{type:"button",onClick:()=>h("forme","text"),className:`px-2.5 py-1 text-xs ${l.forme==="text"?"bg-primary-600 text-white":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200"}`,children:"Texte"}),e.jsx("button",{type:"button",onClick:()=>h("forme","file"),className:`px-2.5 py-1 text-xs ${l.forme==="file"?"bg-primary-600 text-white":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200"}`,children:"Fichier"})]})]}),l.forme==="text"?e.jsx(x,{label:"Forme juridique (texte)",value:s.forme_juridique,onChange:t=>a("forme_juridique",t.target.value)}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Forme juridique (fichier)"}),e.jsxs("label",{className:"flex items-center justify-center border-2 border-dashed rounded-lg py-7 px-3 text-sm text-gray-500 dark:text-gray-400 border-gray-300 dark:border-gray-700 hover:border-primary-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors cursor-pointer",children:[e.jsx("input",{className:"hidden",type:"file",onChange:t=>{var i;return a("forme_juridique_file",((i=t.target.files)==null?void 0:i[0])||null)}}),s.forme_juridique_file?e.jsxs("div",{className:"w-full flex items-center justify-between gap-2",children:[e.jsx("span",{className:"truncate",children:s.forme_juridique_file.name}),e.jsx("button",{type:"button",className:"text-red-600 dark:text-red-400 text-xs",onClick:()=>a("forme_juridique_file",null),children:"Retirer"})]}):e.jsx("span",{children:"Glisser-déposer ou cliquer pour choisir"})]})]})]}),e.jsxs("div",{className:"md:col-span-2 grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(x,{label:"Statut juridique",value:s.statut_juridique,onChange:t=>a("statut_juridique",t.target.value)}),e.jsx(x,{label:"Date de création",type:"date",value:s.date_creation||"",onChange:t=>a("date_creation",t.target.value)}),e.jsx(x,{label:"Régime fiscal",value:s.regime_fiscal,onChange:t=>a("regime_fiscal",t.target.value)}),e.jsx(x,{label:"Capital social",type:"number",step:"0.01",value:s.capital_social||"",onChange:t=>a("capital_social",t.target.value)})]})]})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-700 bg-white/60 dark:bg-gray-900/40 backdrop-blur p-4 md:p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"w-1.5 h-6 bg-gradient-to-b from-primary-400 to-primary-600 rounded"}),e.jsx("h4",{className:"text-sm font-semibold text-gray-800 dark:text-gray-100",children:"Opérationnel"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(x,{label:"Début de collaboration",type:"date",value:s.date_debut_collaboration||"",onChange:t=>a("date_debut_collaboration",t.target.value)}),e.jsx(x,{label:"Type de mission",value:s.type_mission,onChange:t=>a("type_mission",t.target.value)}),e.jsx(x,{label:"Montant contrat (€)",type:"number",step:"0.01",value:s.montant_contrat??"",onChange:t=>a("montant_contrat",t.target.value)})]})]})]})})}function J({client:r,onClose:p}){const u=!!r,y=A(),{data:b=[],isLoading:m}=T({queryKey:["client-docs",r==null?void 0:r.id],queryFn:async()=>{if(!(r!=null&&r.id))return[];const{data:o}=await f.get(`/clients/${r.id}/documents`);return o},enabled:!!(r!=null&&r.id)}),j=S({mutationFn:async({file:o,category:n,title:w,is_confidential:F})=>{const _=new FormData;_.append("file",o),n&&_.append("category",n),w&&_.append("title",w),F&&_.append("is_confidential","1");const{data:E}=await f.post(`/clients/${r.id}/documents`,_,{headers:{"Content-Type":"multipart/form-data"}});return E},onSuccess:()=>y.invalidateQueries({queryKey:["client-docs",r==null?void 0:r.id]})}),s=S({mutationFn:async o=>{await f.delete(`/clients/${r.id}/documents/${o}`)},onSuccess:()=>y.invalidateQueries({queryKey:["client-docs",r==null?void 0:r.id]})}),[c,l]=g.useState(null),[d,a]=g.useState(null),[h,k]=g.useState(""),[v,t]=g.useState(""),[i,C]=g.useState(!1);return e.jsx(H,{open:u,onClose:p,title:r?`Documents - ${r.raison_sociale}`:"Documents",footer:e.jsx("div",{className:"flex gap-3",children:e.jsx(q,{onClick:p,className:"!from-gray-200 !to-gray-300 !text-gray-800",children:"Fermer"})}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fichier"}),e.jsx("input",{type:"file",onChange:o=>{var n;return a(((n=o.target.files)==null?void 0:n[0])||null)}})]}),e.jsx("div",{children:e.jsx(x,{label:"Catégorie",value:h,onChange:o=>k(o.target.value)})}),e.jsx("div",{children:e.jsx(x,{label:"Titre",value:v,onChange:o=>t(o.target.value)})}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 mb-2",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:o=>C(o.target.checked)})," Confidential"]}),e.jsx(q,{disabled:!d||j.isPending,onClick:()=>j.mutate({file:d,category:h,title:v,is_confidential:i}),children:"Téléverser"})]})]}),e.jsx("div",{className:"border-t pt-4",children:m?e.jsx("p",{className:"text-gray-500",children:"Chargement..."}):b.length===0?e.jsx("p",{className:"text-gray-500",children:"Aucun document"}):e.jsx("ul",{className:"divide-y",children:b.map(o=>e.jsxs("li",{className:"py-2 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-800",children:o.title}),e.jsxs("p",{className:"text-xs text-gray-500",children:[o.category||"—"," · ",(o.size/1024).toFixed(1)," KB"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("a",{className:"px-3 py-1.5 rounded-lg bg-gradient-to-r from-blue-500 to-blue-600 text-white text-sm",href:`http://127.0.0.1:8002/api/clients/${r.id}/documents/${o.id}/download`,target:"_blank",rel:"noreferrer",children:"Télécharger"}),e.jsx(N.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>l(o),className:"px-3 py-1.5 rounded-lg bg-gradient-to-r from-red-500 to-red-600 text-white text-sm",children:"Supprimer"})]})]},o.id))})}),e.jsx(Q,{open:!!c,title:"Supprimer le document",description:c?`Supprimer le document "${c.title}" ?`:"",onCancel:()=>l(null),onConfirm:()=>{c&&(s.mutate(c.id),l(null))}})]})})}export{se as default};
