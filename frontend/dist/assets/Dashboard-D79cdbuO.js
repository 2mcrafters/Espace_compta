import{j as e,R as u,m,c as b}from"./index-BMkIZVNk.js";import{u as j}from"./useQuery-BJIpt9GR.js";import{I as p}from"./Input-DbISj08U.js";import{B as N}from"./Button-bUw3xPWi.js";function w({start:r,end:s,onChange:i,className:o=""}){return e.jsxs("div",{className:`flex items-end gap-3 ${o}`,children:[e.jsx(p,{label:"Start",type:"date",value:r??"",onChange:l=>i==null?void 0:i({start:l.target.value,end:s})}),e.jsx(p,{label:"End",type:"date",value:s??"",onChange:l=>i==null?void 0:i({start:r,end:l.target.value})})]})}function M(r,s){return j({queryKey:["productivity",r,s],queryFn:async()=>{const{data:i}=await b.get("/reports/productivity",{params:{from:r,to:s}});return i},enabled:!!r&&!!s})}function S(){const r=new Date,s=new Date(r.getFullYear(),r.getMonth(),1).toISOString().slice(0,10),i=new Date(r.getFullYear(),r.getMonth()+1,0).toISOString().slice(0,10),[o,l]=u.useState({start:s,end:i}),{data:t,isLoading:x}=M(o.start,o.end),g=u.useMemo(()=>{var n;return t&&((n=t.per_client)==null?void 0:n.reduce((d,c)=>d+Number(c.minutes||0),0))||0},[t]),v=u.useMemo(()=>{const a=(t==null?void 0:t.per_client)||[];if(a.length===0)return"—";const n=a.reduce((d,c)=>Number(c.minutes)>Number(d.minutes)?c:d,a[0]);return`Client #${n.client_id} (${n.minutes}m)`},[t]),y=u.useMemo(()=>{const a=(t==null?void 0:t.per_user)||[];if(a.length===0)return"—";const n=a.reduce((d,c)=>Number(c.minutes)>Number(d.minutes)?c:d,a[0]);return`User #${n.user_id} (${n.minutes}m)`},[t]),f=[{title:"Total minutes",value:g,icon:"⏱️",color:"from-primary-400 to-primary-600",textColor:"text-primary-700"},{title:"Top client",value:v,icon:"🏆",color:"from-purple-500 to-pink-500",textColor:"text-pink-600"},{title:"Top collaborator",value:y,icon:"⭐",color:"from-orange-500 to-red-500",textColor:"text-red-600"}];return e.jsxs("div",{className:"space-y-8",children:[e.jsxs(m.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex flex-col md:flex-row md:items-end md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent mb-2",children:"Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Vue d'ensemble de votre productivité"})]}),e.jsxs("div",{className:"flex flex-wrap items-end gap-3",children:[e.jsx(w,{start:o.start,end:o.end,onChange:l}),e.jsx("a",{target:"_blank",rel:"noreferrer",href:"http://127.0.0.1:8002/api/exports/time-excel",children:e.jsxs(N,{className:"!from-emerald-500 !to-green-600 !shadow-emerald-500/30 hover:!shadow-emerald-500/50 hover:!from-emerald-600 hover:!to-green-700",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Exporter (Excel)"]})})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:f.map((a,n)=>e.jsxs(m.div,{initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:n*.1},whileHover:{y:-8,scale:1.03,boxShadow:"0 25px 50px rgba(0, 0, 0, 0.15)",transition:{type:"spring",stiffness:300}},className:"relative overflow-hidden rounded-2xl bg-white border border-gray-200 p-6 shadow-lg transition-all duration-300 cursor-pointer group",children:[e.jsx("div",{className:`absolute top-0 right-0 w-32 h-32 bg-gradient-to-br ${a.color} opacity-10 rounded-full -translate-y-1/2 translate-x-1/2 group-hover:opacity-20 transition-opacity duration-300`}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent via-white/50 to-transparent opacity-0 group-hover:opacity-100 transform -translate-x-full group-hover:translate-x-full transition-all duration-1000"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-600",children:a.title}),e.jsx(m.div,{animate:{rotate:[0,10,-10,0]},transition:{duration:2,repeat:1/0,repeatDelay:3},whileHover:{scale:1.2,rotate:360},className:"text-3xl",children:a.icon})]}),e.jsx("div",{className:`text-3xl font-bold ${a.textColor}`,children:x?e.jsx("div",{className:"h-9 bg-gray-200 rounded animate-pulse w-24"}):a.value})]})]},n))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(h,{title:"Minutes par client",data:((t==null?void 0:t.per_client)||[]).map(a=>({label:`C${a.client_id}`,value:Number(a.minutes||0)})),isLoading:x}),e.jsx(h,{title:"Minutes par collaborateur",data:((t==null?void 0:t.per_user)||[]).map(a=>({label:`U${a.user_id}`,value:Number(a.minutes||0)})),isLoading:x})]})]})}function h({title:r,data:s,isLoading:i}){const o=Math.max(1,...s.map(l=>l.value));return e.jsxs(m.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-lg",children:[e.jsx("h3",{className:"font-semibold text-lg mb-6 text-gray-900",children:r}),e.jsx("div",{className:"space-y-4",children:i?Array.from({length:3}).map((l,t)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-4 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"flex-1 h-6 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"w-12 h-4 bg-gray-200 rounded animate-pulse"})]},t)):s.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-2 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),"Aucune donnée"]}):s.map((l,t)=>e.jsxs(m.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:t*.05},className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 text-xs font-medium text-gray-600",children:l.label}),e.jsx("div",{className:"flex-1 h-8 bg-gradient-to-r from-gray-100 to-gray-50 rounded-lg overflow-hidden",children:e.jsx(m.div,{initial:{width:0},animate:{width:`${l.value/o*100}%`},transition:{duration:1,delay:t*.1,ease:"easeOut"},className:"h-full bg-gradient-to-r from-primary-500 to-primary-700 rounded-lg shadow-sm"})}),e.jsxs("div",{className:"w-12 text-xs font-semibold text-gray-900 text-right",children:[l.value,"m"]})]},t))})]})}export{S as default};
