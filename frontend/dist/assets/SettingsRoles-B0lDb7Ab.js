import{e as j,j as e,m as t,d as g}from"./index-DdO7h4Wl.js";import{u as b}from"./useQuery-Y4CYsnxM.js";import{u as v}from"./useMutation-DGNKXV8s.js";import{R as N}from"./RequirePermission-3d12Kf4X.js";import{B as w}from"./Button-8PE0XvOC.js";function q(){var x,h;const m=j(),{data:a,isLoading:u,error:l}=b({queryKey:["roles-permissions"],queryFn:async()=>{try{return(await g.get("/roles-permissions")).data}catch(s){throw console.error("Error fetching roles & permissions:",s),s}}}),c=v({mutationFn:async({roleId:s,permissions:i})=>{try{return(await g.put(`/roles/${s}/permissions`,{permissions:i})).data}catch(r){throw console.error("Error updating permissions:",r),r}},onSuccess:()=>{m.invalidateQueries({queryKey:["roles-permissions"]})},onError:s=>{var r,n,y;const i=((r=s.response)==null?void 0:r.status)===403?"Vous n'avez pas la permission de modifier les rôles":((y=(n=s.response)==null?void 0:n.data)==null?void 0:y.message)||s.message||"Impossible de mettre à jour les permissions";alert(`Erreur: ${i}`)}}),o=(a==null?void 0:a.roles)??[],d=(a==null?void 0:a.permissions)??[],p=(a==null?void 0:a.matrix)??{};function f(s,i){const r=new Set(p[s.name]||[]);r.has(i.name)?r.delete(i.name):r.add(i.name),c.mutate({roleId:s.id,permissions:Array.from(r)})}return e.jsx(N,{perm:"users.edit",fallback:e.jsxs(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-red-50 border border-red-200 text-red-700 px-6 py-8 rounded-xl text-center",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),e.jsx("p",{className:"text-xl font-semibold mb-2",children:"Accès refusé"}),e.jsx("p",{className:"text-sm",children:"Vous n'avez pas la permission d'accéder à cette page"})]}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(t.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent mb-2",children:"Rôles et permissions"}),e.jsx("p",{className:"text-gray-600",children:"Gérez les permissions pour chaque rôle utilisateur"})]}),l&&e.jsxs(t.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl",children:[e.jsx("p",{className:"font-medium",children:"Erreur de chargement"}),e.jsx("p",{className:"text-sm",children:((h=(x=l.response)==null?void 0:x.data)==null?void 0:h.message)||l.message||"Impossible de charger les rôles et permissions"})]}),u?e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((s,i)=>e.jsx(t.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:i*.05},className:"h-16 bg-gray-200 rounded-xl animate-pulse"},i))}):e.jsxs(e.Fragment,{children:[e.jsx(t.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gradient-to-r from-gray-50 to-gray-100 border-b border-gray-200",children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider sticky left-0 bg-gradient-to-r from-gray-50 to-gray-100 z-10",children:"Permission"}),o.map((s,i)=>{var r,n;return e.jsx("th",{className:"px-6 py-4 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider min-w-[120px]",children:e.jsxs(t.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:i*.05},className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary-400 to-primary-700 flex items-center justify-center text-white font-bold shadow-lg",children:((n=(r=s.name)==null?void 0:r[0])==null?void 0:n.toUpperCase())||"R"}),e.jsx("span",{children:s.name})]})},s.id)})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:d.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:o.length+1,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-gray-400",children:[e.jsx("svg",{className:"w-16 h-16 mb-3 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),e.jsx("p",{className:"font-medium",children:"Aucune permission"})]})})}):d.map((s,i)=>e.jsxs(t.tr,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:i*.03},className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900 sticky left-0 bg-white hover:bg-gray-50 z-10",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),s.name]})}),o.map(r=>{const n=(p[r.name]||[]).includes(s.name);return e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsxs("label",{className:"inline-flex flex-col items-center gap-1 cursor-pointer group",children:[e.jsx(t.input,{type:"checkbox",checked:n,onChange:()=>f(r,s),disabled:c.isPending,whileHover:{scale:1.1},whileTap:{scale:.9},className:"w-5 h-5 text-primary-600 border-2 border-gray-300 rounded focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed transition-all"}),e.jsx("span",{className:`text-xs font-medium px-2 py-0.5 rounded-full transition-all ${n?"bg-green-100 text-green-700 group-hover:bg-green-200":"bg-gray-100 text-gray-500 group-hover:bg-gray-200"}`,children:n?"Activé":"Désactivé"})]})},r.id)})]},s.id))})]})})}),e.jsxs(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:[d.length," permission(s) · ",o.length," rôle(s)"]}),e.jsxs(w,{onClick:()=>m.invalidateQueries({queryKey:["roles-permissions"]}),className:"!from-gray-600 !to-gray-700",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Rafraîchir"]})]}),c.isPending&&e.jsxs(t.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed bottom-4 right-4 bg-primary-600 text-white px-4 py-3 rounded-lg shadow-xl flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Mise à jour..."})]})]})]})})}export{q as default};
