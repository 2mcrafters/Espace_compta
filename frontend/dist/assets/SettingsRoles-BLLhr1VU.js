import{e as u,j as e,d as o}from"./index-6jc1YW1i.js";import{u as p}from"./useQuery-SKqCO6Ti.js";import{u as h}from"./useMutation-ClYfTwts.js";import{R as f}from"./RequirePermission-Dz9kGamF.js";import{B as j}from"./Button-DWzqGaEt.js";function q(){const t=u(),{data:i,isLoading:c}=p({queryKey:["roles-permissions"],queryFn:async()=>(await o.get("/roles-permissions")).data}),m=h({mutationFn:async({roleId:s,permissions:n})=>(await o.put(`/roles/${s}/permissions`,{permissions:n})).data,onSuccess:()=>t.invalidateQueries({queryKey:["roles-permissions"]})});if(c)return e.jsx("div",{children:"Chargement…"});const a=(i==null?void 0:i.roles)??[],d=(i==null?void 0:i.permissions)??[],l=(i==null?void 0:i.matrix)??{};function x(s,n){const r=new Set(l[s.name]||[]);r.has(n.name)?r.delete(n.name):r.add(n.name),m.mutate({roleId:s.id,permissions:Array.from(r)})}return e.jsx(f,{perm:"users.edit",fallback:e.jsx("div",{className:"text-red-600",children:"Accès refusé"}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Rôles & permissions"}),e.jsx("div",{className:"overflow-auto border rounded-xl",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Permission"}),a.map(s=>e.jsx("th",{className:"px-3 py-2 text-left",children:s.name},s.id))]})}),e.jsx("tbody",{children:d.map(s=>e.jsxs("tr",{className:"odd:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2 font-medium",children:s.name}),a.map(n=>{const r=(l[n.name]||[]).includes(s.name);return e.jsx("td",{className:"px-3 py-2",children:e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:()=>x(n,s)}),e.jsx("span",{className:"text-xs text-gray-500",children:r?"On":"Off"})]})},n.id)})]},s.id))})]})}),e.jsx("div",{children:e.jsx(j,{onClick:()=>t.invalidateQueries({queryKey:["roles-permissions"]}),children:"Rafraîchir"})})]})})}export{q as default};
