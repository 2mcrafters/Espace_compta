import{R as l,j as e,d as c}from"./index-pDHLf4_7.js";import{u as x}from"./useQuery-kMVKj7Cj.js";import{R as b}from"./RequirePermission-TZbtanVt.js";import{B as w}from"./Button-CzOS0oQW.js";function C(r,t){return x({queryKey:["reports","productivity",r,t],queryFn:async()=>(await c.get("/reports/productivity",{params:{from:r,to:t}})).data,enabled:!!r&&!!t})}function _(r,t,s){return x({queryKey:["reports","timesheet",r,t,s],queryFn:async()=>(await c.get("/reports/timesheet",{params:{from:r,to:t,user_id:s||void 0}})).data,enabled:!!r&&!!t})}function F(r,t){return x({queryKey:["reports","client-costs",r,t],queryFn:async()=>(await c.get("/reports/client-costs",{params:{from:r,to:t}})).data,enabled:!!r&&!!t})}function D(){var g,h,p,o;const[r,t]=l.useState("productivity"),[s,j]=l.useState(new Date().toISOString().slice(0,10)),[i,N]=l.useState(new Date().toISOString().slice(0,10)),[n,k]=l.useState(""),y=C(s,i),v=_(s,i,n),f=F(s,i);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-gray-100 dark:to-gray-400 bg-clip-text text-transparent",children:"Rapports"}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-300",children:"Du"}),e.jsx("input",{type:"date",value:s,onChange:a=>j(a.target.value),className:"border rounded px-2 py-1 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-300",children:"Au"}),e.jsx("input",{type:"date",value:i,onChange:a=>N(a.target.value),className:"border rounded px-2 py-1 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100"})]}),e.jsx("div",{className:"ml-auto flex gap-2",children:e.jsx(w,{onClick:()=>{},children:"Actualiser"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>t("productivity"),className:`px-3 py-1 rounded ${r==="productivity"?"bg-primary-600 text-white":"bg-gray-100 dark:bg-gray-800 dark:text-gray-200"}`,children:"Productivité"}),e.jsx("button",{onClick:()=>t("timesheet"),className:`px-3 py-1 rounded ${r==="timesheet"?"bg-primary-600 text-white":"bg-gray-100 dark:bg-gray-800 dark:text-gray-200"}`,children:"Feuille de temps"}),e.jsx(b,{perm:"users.rate.set",fallback:e.jsx("span",{className:"px-3 py-1 rounded bg-gray-200 text-gray-500",children:"Coûts clients (restreint)"}),children:e.jsx("button",{onClick:()=>t("costs"),className:`px-3 py-1 rounded ${r==="costs"?"bg-primary-600 text-white":"bg-gray-100 dark:bg-gray-800 dark:text-gray-200"}`,children:"Coûts clients"})})]}),r==="productivity"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border rounded-xl overflow-hidden border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:[e.jsx("div",{className:"px-3 py-2 font-semibold bg-gray-50 dark:bg-gray-900/30 border-b border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100",children:"Minutes par client"}),e.jsxs("table",{className:"min-w-full text-sm text-gray-800 dark:text-gray-100",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900/20",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Client"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Minutes"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Heures"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:(((g=y.data)==null?void 0:g.per_client)||[]).map((a,d)=>e.jsxs("tr",{className:"odd:bg-gray-50 dark:odd:bg-gray-900/10",children:[e.jsx("td",{className:"px-3 py-2",children:a.client_id}),e.jsx("td",{className:"px-3 py-2 text-right",children:a.minutes}),e.jsx("td",{className:"px-3 py-2 text-right",children:(a.minutes/60).toFixed(2)})]},d))})]})]}),e.jsxs("div",{className:"border rounded-xl overflow-hidden border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:[e.jsx("div",{className:"px-3 py-2 font-semibold bg-gray-50 dark:bg-gray-900/30 border-b border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100",children:"Minutes par collaborateur"}),e.jsxs("table",{className:"min-w-full text-sm text-gray-800 dark:text-gray-100",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900/20",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Utilisateur"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Minutes"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Heures"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:(((h=y.data)==null?void 0:h.per_user)||[]).map((a,d)=>e.jsxs("tr",{className:"odd:bg-gray-50 dark:odd:bg-gray-900/10",children:[e.jsx("td",{className:"px-3 py-2",children:a.user_id}),e.jsx("td",{className:"px-3 py-2 text-right",children:a.minutes}),e.jsx("td",{className:"px-3 py-2 text-right",children:(a.minutes/60).toFixed(2)})]},d))})]})]})]}),r==="timesheet"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex gap-2 items-end",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-300",children:"Utilisateur (ID)"}),e.jsx("input",{type:"number",value:n,onChange:a=>k(a.target.value),placeholder:"Facultatif",className:"border rounded px-2 py-1 w-40 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-100"})]})}),e.jsx("div",{className:"border rounded-xl overflow-hidden border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:e.jsxs("table",{className:"min-w-full text-sm text-gray-800 dark:text-gray-100",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900/20",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Début"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Fin"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Min"}),e.jsx("th",{className:"px-3 py-2",children:"Tâche"}),e.jsx("th",{className:"px-3 py-2",children:"Client"}),e.jsx("th",{className:"px-3 py-2",children:"Utilisateur"}),e.jsx("th",{className:"px-3 py-2",children:"Commentaire"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:(((p=v.data)==null?void 0:p.entries)||[]).map((a,d)=>{var m,u;return e.jsxs("tr",{className:"odd:bg-gray-50 dark:odd:bg-gray-900/10",children:[e.jsx("td",{className:"px-3 py-2",children:a.start_at}),e.jsx("td",{className:"px-3 py-2",children:a.end_at}),e.jsx("td",{className:"px-3 py-2 text-right",children:a.minutes}),e.jsx("td",{className:"px-3 py-2",children:a.task_id}),e.jsx("td",{className:"px-3 py-2",children:a.client_id}),e.jsx("td",{className:"px-3 py-2",children:((m=a.user)==null?void 0:m.name)||((u=a.user)==null?void 0:u.email)}),e.jsx("td",{className:"px-3 py-2",children:a.comment})]},d)})})]})})]}),r==="costs"&&e.jsx(b,{perm:"users.rate.set",fallback:e.jsx("div",{className:"text-red-600",children:"Accès restreint"}),children:e.jsx("div",{className:"border rounded-xl overflow-hidden border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:e.jsxs("table",{className:"min-w-full text-sm text-gray-800 dark:text-gray-100",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900/20",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Client"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Minutes"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Heures"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Coût (MAD)"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:(((o=f.data)==null?void 0:o.per_client)||[]).map((a,d)=>e.jsxs("tr",{className:"odd:bg-gray-50 dark:odd:bg-gray-900/10",children:[e.jsx("td",{className:"px-3 py-2",children:a.client_id}),e.jsx("td",{className:"px-3 py-2 text-right",children:a.minutes}),e.jsx("td",{className:"px-3 py-2 text-right",children:a.hours.toFixed(2)}),e.jsx("td",{className:"px-3 py-2 text-right",children:a.cost_mad.toFixed(2)})]},d))})]})})})]})}export{D as default};
