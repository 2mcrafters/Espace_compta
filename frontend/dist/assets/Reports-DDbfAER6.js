import{R as d,j as e,d as c}from"./index-DrS59qMr.js";import{u as n}from"./useQuery-DxNF-Ufy.js";import{R as N}from"./RequirePermission-EK-aUSRO.js";import{B as C}from"./Button-zGB7KR70.js";function _(t,a){return n({queryKey:["reports","productivity",t,a],queryFn:async()=>(await c.get("/reports/productivity",{params:{from:t,to:a}})).data,enabled:!!t&&!!a})}function F(t,a,l){return n({queryKey:["reports","timesheet",t,a,l],queryFn:async()=>(await c.get("/reports/timesheet",{params:{from:t,to:a,user_id:l||void 0}})).data,enabled:!!t&&!!a})}function S(t,a){return n({queryKey:["reports","client-costs",t,a],queryFn:async()=>(await c.get("/reports/client-costs",{params:{from:t,to:a}})).data,enabled:!!t&&!!a})}function D(){var h,m,o,u;const[t,a]=d.useState("productivity"),[l,g]=d.useState(new Date().toISOString().slice(0,10)),[i,b]=d.useState(new Date().toISOString().slice(0,10)),[x,v]=d.useState(""),p=_(l,i),f=F(l,i,x),w=S(l,i);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Rapports"}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Du"}),e.jsx("input",{type:"date",value:l,onChange:s=>g(s.target.value),className:"border rounded px-2 py-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Au"}),e.jsx("input",{type:"date",value:i,onChange:s=>b(s.target.value),className:"border rounded px-2 py-1"})]}),e.jsx("div",{className:"ml-auto flex gap-2",children:e.jsx(C,{onClick:()=>{},children:"Actualiser"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>a("productivity"),className:`px-3 py-1 rounded ${t==="productivity"?"bg-primary-600 text-white":"bg-gray-100"}`,children:"Productivité"}),e.jsx("button",{onClick:()=>a("timesheet"),className:`px-3 py-1 rounded ${t==="timesheet"?"bg-primary-600 text-white":"bg-gray-100"}`,children:"Feuille de temps"}),e.jsx(N,{perm:"users.rate.set",fallback:e.jsx("span",{className:"px-3 py-1 rounded bg-gray-200 text-gray-500",children:"Coûts clients (restreint)"}),children:e.jsx("button",{onClick:()=>a("costs"),className:`px-3 py-1 rounded ${t==="costs"?"bg-primary-600 text-white":"bg-gray-100"}`,children:"Coûts clients"})})]}),t==="productivity"&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border rounded-xl overflow-hidden",children:[e.jsx("div",{className:"px-3 py-2 font-semibold bg-gray-50 border-b",children:"Minutes par client"}),e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Client"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Minutes"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Heures"})]})}),e.jsx("tbody",{children:(((h=p.data)==null?void 0:h.per_client)||[]).map((s,r)=>e.jsxs("tr",{className:"odd:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2",children:s.client_id}),e.jsx("td",{className:"px-3 py-2 text-right",children:s.minutes}),e.jsx("td",{className:"px-3 py-2 text-right",children:(s.minutes/60).toFixed(2)})]},r))})]})]}),e.jsxs("div",{className:"border rounded-xl overflow-hidden",children:[e.jsx("div",{className:"px-3 py-2 font-semibold bg-gray-50 border-b",children:"Minutes par collaborateur"}),e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Utilisateur"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Minutes"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Heures"})]})}),e.jsx("tbody",{children:(((m=p.data)==null?void 0:m.per_user)||[]).map((s,r)=>e.jsxs("tr",{className:"odd:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2",children:s.user_id}),e.jsx("td",{className:"px-3 py-2 text-right",children:s.minutes}),e.jsx("td",{className:"px-3 py-2 text-right",children:(s.minutes/60).toFixed(2)})]},r))})]})]})]}),t==="timesheet"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex gap-2 items-end",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Utilisateur (ID)"}),e.jsx("input",{type:"number",value:x,onChange:s=>v(s.target.value),placeholder:"Facultatif",className:"border rounded px-2 py-1 w-40"})]})}),e.jsx("div",{className:"border rounded-xl overflow-hidden",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Début"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Fin"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Min"}),e.jsx("th",{className:"px-3 py-2",children:"Tâche"}),e.jsx("th",{className:"px-3 py-2",children:"Client"}),e.jsx("th",{className:"px-3 py-2",children:"Utilisateur"}),e.jsx("th",{className:"px-3 py-2",children:"Commentaire"})]})}),e.jsx("tbody",{children:(((o=f.data)==null?void 0:o.entries)||[]).map((s,r)=>{var y,j;return e.jsxs("tr",{className:"odd:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2",children:s.start_at}),e.jsx("td",{className:"px-3 py-2",children:s.end_at}),e.jsx("td",{className:"px-3 py-2 text-right",children:s.minutes}),e.jsx("td",{className:"px-3 py-2",children:s.task_id}),e.jsx("td",{className:"px-3 py-2",children:s.client_id}),e.jsx("td",{className:"px-3 py-2",children:((y=s.user)==null?void 0:y.name)||((j=s.user)==null?void 0:j.email)}),e.jsx("td",{className:"px-3 py-2",children:s.comment})]},r)})})]})})]}),t==="costs"&&e.jsx(N,{perm:"users.rate.set",fallback:e.jsx("div",{className:"text-red-600",children:"Accès restreint"}),children:e.jsx("div",{className:"border rounded-xl overflow-hidden",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Client"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Minutes"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Heures"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Coût (MAD)"})]})}),e.jsx("tbody",{children:(((u=w.data)==null?void 0:u.per_client)||[]).map((s,r)=>e.jsxs("tr",{className:"odd:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2",children:s.client_id}),e.jsx("td",{className:"px-3 py-2 text-right",children:s.minutes}),e.jsx("td",{className:"px-3 py-2 text-right",children:s.hours.toFixed(2)}),e.jsx("td",{className:"px-3 py-2 text-right",children:s.cost_mad.toFixed(2)})]},r))})]})})})]})}export{D as default};
