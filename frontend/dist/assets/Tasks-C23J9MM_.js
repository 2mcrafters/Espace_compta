import{d as j,R as p,j as e,m as o,c as x}from"./index-BMkIZVNk.js";import{u as w}from"./useQuery-BJIpt9GR.js";import{u as y,A as N,R as v}from"./RequirePermission-CJj8IMy5.js";import{S as k}from"./Select-DioNywv0.js";const f=[{key:"EN_ATTENTE",label:"En attente",color:"from-gray-400 to-gray-500",bgColor:"bg-gray-50",borderColor:"border-gray-200"},{key:"EN_COURS",label:"En cours",color:"from-primary-400 to-primary-700",bgColor:"bg-primary-50",borderColor:"border-primary-200"},{key:"EN_VALIDATION",label:"En validation",color:"from-amber-400 to-orange-500",bgColor:"bg-amber-50",borderColor:"border-amber-200"},{key:"TERMINEE",label:"Terminée",color:"from-emerald-400 to-green-600",bgColor:"bg-emerald-50",borderColor:"border-emerald-200"}];function C(){return w({queryKey:["tasks"],queryFn:async()=>{const{data:t}=await x.get("/tasks");return t.data??t}})}function A(){const t=j(),{data:d=[],isLoading:c}=C(),[n,m]=p.useState({}),h=y({mutationFn:async a=>{const{data:r}=await x.post(`/tasks/${a}/time/start`,{});return r},onSuccess:a=>{m(r=>({...r,[a.task_id]:a.id}))}}),i=y({mutationFn:async a=>{const{data:r}=await x.post(`/time-entries/${a}/stop`,{});return r},onSuccess:a=>{m(r=>({...r,[a.task_id]:void 0}))}}),u=y({mutationFn:async({taskId:a,userId:r})=>{const{data:s}=await x.post(`/tasks/${a}/assign`,{user_id:Number(r)});return s},onSuccess:()=>{t.invalidateQueries({queryKey:["tasks"]})}}),l=p.useMemo(()=>{const a=Object.fromEntries(f.map(r=>[r.key,[]]));for(const r of d)a[r.status??"EN_ATTENTE"].push(r);return a},[d]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(o.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent mb-2",children:"Tâches"}),e.jsx("p",{className:"text-gray-600",children:"Suivez et gérez vos tâches par statut"})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:f.map((a,r)=>e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:r*.1},className:`rounded-2xl border-2 ${a.borderColor} ${a.bgColor} overflow-hidden shadow-lg`,children:[e.jsxs("div",{className:`bg-gradient-to-r ${a.color} px-4 py-3`,children:[e.jsx("h3",{className:"font-bold text-white text-sm uppercase tracking-wide",children:a.label}),e.jsxs("div",{className:"text-xs text-white/80 mt-0.5",children:[(l[a.key]??[]).length," tâche(s)"]})]}),e.jsx("div",{className:"p-4 space-y-3 min-h-[200px]",children:c?Array.from({length:2}).map((s,g)=>e.jsx("div",{className:"h-32 bg-white/50 rounded-xl animate-pulse"},g)):(l[a.key]??[]).length===0?e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-2 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsx("p",{className:"text-sm",children:"Aucune tâche"})]}):e.jsx(N,{children:(l[a.key]??[]).map((s,g)=>e.jsx(T,{task:s,index:g,runningEntryId:n[s.id],onStart:()=>h.mutate(s.id),onStop:()=>n[s.id]&&i.mutate(n[s.id]),onAssign:b=>u.mutate({taskId:s.id,userId:b})},s.id))})})]},a.key))})]})}function T({task:t,index:d,runningEntryId:c,onStart:n,onStop:m,onAssign:h}){const[i,u]=p.useState(""),[l,a]=p.useState(!1);return e.jsxs(o.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{delay:d*.05},whileHover:{y:-3,scale:1.02},onHoverStart:()=>a(!0),onHoverEnd:()=>a(!1),className:"relative rounded-xl border-2 border-gray-200 bg-white p-4 shadow-md hover:shadow-xl transition-all duration-300",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gray-100 rounded-t-xl overflow-hidden",children:e.jsx(o.div,{initial:{width:0},animate:{width:`${t.progress??0}%`},transition:{duration:1,ease:"easeOut"},className:"h-full bg-gradient-to-r from-primary-500 to-primary-700"})}),e.jsxs("div",{className:"flex items-start justify-between gap-3 mt-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:t.title??t.name??`Tâche #${t.id}`}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-gray-500",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})}),t.category||"Général"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),t.due_at??"—"]})]})]}),e.jsxs(o.div,{animate:{scale:l?1.1:1},className:"text-sm font-bold text-gray-700 px-2 py-1 rounded-lg bg-gray-100",children:[t.progress??0,"%"]})]}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[e.jsx(v,{perm:"tasks.manage",fallback:c?e.jsx("div",{className:"text-xs text-center text-red-600 py-1",children:"Pas de permission"}):e.jsx("div",{className:"text-xs text-center text-red-600 py-1",children:"Pas de permission"}),children:c?e.jsxs(o.button,{animate:{boxShadow:["0 0 0 0 rgba(244, 63, 94, 0.4)","0 0 0 8px rgba(244, 63, 94, 0)"]},transition:{duration:1.5,repeat:1/0},whileHover:{scale:1.03,y:-2,boxShadow:"0 15px 30px rgba(239, 68, 68, 0.5)"},whileTap:{scale:.97},onClick:m,className:"w-full px-3 py-2.5 rounded-lg bg-gradient-to-r from-rose-500 to-red-600 hover:from-rose-600 hover:to-red-700 text-white font-semibold shadow-lg transition-all duration-300 flex items-center justify-center gap-2 relative overflow-hidden group",children:[e.jsx("span",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent opacity-0 group-hover:opacity-100 transform -translate-x-full group-hover:translate-x-full transition-all duration-700"}),e.jsxs("svg",{className:"w-5 h-5 relative z-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"})]}),e.jsx("span",{className:"relative z-10",children:"Arrêter"})]}):e.jsxs(o.button,{whileHover:{scale:1.03,y:-2,boxShadow:"0 15px 30px rgba(16, 185, 129, 0.4)"},whileTap:{scale:.97},onClick:n,className:"w-full px-3 py-2.5 rounded-lg bg-gradient-to-r from-emerald-500 to-green-600 hover:from-emerald-600 hover:to-green-700 text-white font-semibold shadow-lg transition-all duration-300 flex items-center justify-center gap-2 relative overflow-hidden group",children:[e.jsx("span",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent opacity-0 group-hover:opacity-100 transform -translate-x-full group-hover:translate-x-full transition-all duration-700"}),e.jsxs("svg",{className:"w-5 h-5 relative z-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),e.jsx("span",{className:"relative z-10",children:"Démarrer"})]})}),e.jsx(v,{perm:"tasks.manage",fallback:e.jsx("div",{className:"text-xs text-center text-red-600 py-1",children:"Pas de permission"}),children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{value:i,onChange:r=>u(r.target.value),options:[{value:"",label:"Assigner…"},1,2,3,4].map(r=>typeof r=="object"?r:{value:r,label:`User ${r}`}),className:"flex-1 text-sm"}),e.jsxs(o.button,{whileHover:{scale:1.05,y:-2,boxShadow:"0 10px 20px rgba(75, 85, 99, 0.4)"},whileTap:{scale:.95},onClick:()=>i&&h(i),disabled:!i,className:"px-4 py-2 rounded-lg bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white text-sm font-semibold shadow-md transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 relative overflow-hidden group",children:[e.jsx("span",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent opacity-0 group-hover:opacity-100 transform -translate-x-full group-hover:translate-x-full transition-all duration-500"}),e.jsx("span",{className:"relative z-10",children:"OK"})]})]})})]})]})}export{A as default};
